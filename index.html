<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>24</title>
	<style>
.box {
	margin: 20px;
	padding: 10px;
}
.round {
	font-size: 20pt;
	padding-left: 40px;
	padding-right: 40px;
	height: 100px;
	width: auto;
	min-width: 100px;
	border-radius: 50px;
	position: absolute;
	-webkit-transition: width 2s; /* Safari */
    transition: width 2s ease;
}
.round.operator {
	font-size: 14pt;
	padding-left: 20px;
	padding-right: 20px;
	height: 50px;
	width: auto;
	min-width: 50px;
	border-radius: 25px;
	/* initially, they are hidden */
	display: none;
}

.round.active {
	color: red;
	border-color: red;
}
	</style>
</head>
<body>
	<div class="box">
		<input type="number" name="i[]">
		<input type="number" name="i[]">
		<input type="number" name="i[]">
		<input type="number" name="i[]">
		<button type="button" id="generate">Generate!</button>
		<button type="button" id="check">Check!</button>
	</div>

	<div class="arena">
		<button class="round bubble" id="bubble-0" data-bubble="0">
			1
		</button>

		<button class="round bubble" id="bubble-1" data-bubble="1">
			2
		</button>

		<button class="round bubble" id="bubble-2" data-bubble="2">
			3
		</button>

		<button class="round bubble" id="bubble-3" data-bubble="3">
			4
		</button>

		<button class="round operator" id="add">
			+
		</button>

		<button class="round operator" id="subtract">
			-
		</button>

		<button class="round operator" id="multiply">
			x
		</button>

		<button class="round operator" id="divide">
			/
		</button>
	</div>

	<script type="text/javascript" src="assets/js/24.js"></script>
	<script src="//code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
	<script src="assets/js/jquery.cssAnimateAuto.min.js" type="text/javascript"></script>
	<script>
$(function() {
	var game = new Game();
	var operators = ['#add', '#subtract', '#multiply', '#divide'];
	var offset = [
		{left: -90, top: 80},
		{left: -30, top: 100},
		{left: +30, top: 100},
		{left: +90, top: 80}
	];
	var activeOperand = null;

	var showOperators = (function(position) {
		$.each(operators, function(i, e) {
			$(e).show()
			.offset(position)
			.css('opacity', 0)
			.animate({
				opacity: 1,
				left: '+=' + offset[i].left,
				top: '+=' + offset[i].top,
			}, 500);
		});
		// alert(JSON.stringify(position));
	});

	var hideOperators = (function() {
		$.each(operators, function(i, e) {
			$(e).hide();
		});
		activeOperand = null;
	});

	var draggableOptions = {
		cancel: "input,textarea,select,option",
		start: function(e, ui) {
			$(this).css('z-index', 1000);
		},
		stop: function(e, ui) {
			$(this).css('z-index', 0);
		}
	};

	var droppableOptions = {
		activate: function(e, ui) {
			ui.draggable.addClass('active');
		},
		deactivate: function(e, ui) {
			ui.draggable.removeClass('active');
		},
		drop: function(e, ui) {
			var rhs = $(this).data('bubble');
			var lhs = ui.draggable.data('bubble');

			if (rhs === "x" || lhs === "x") return;

			// if there's active operand separate them
			if (activeOperand !== null) {
				$('#bubble-x').trigger('dblclick');
			}

			var bubble = newBubble(lhs, rhs);
			// ui.draggable.hide();
			// $(this).text($(this).text() + " x " + ui.draggable.text());
			// $('#add').offset($(this).offset()).css('opacity', 0);
			// $('#add').animate({
			// 	opacity: 1,
			// 	display: 'block',
			// 	left: '+=-50',
			// 	top: '+=50'
			// }, 500);
			showOperators({
				left: bubble.offset().left + bubble.width() / 2,
				top: bubble.offset().top + bubble.height() / 2
			});
			activeOperand = {
				lhs: lhs,
				rhs: rhs
			}

			$(this).hide();
			ui.draggable.hide();
		},
		hoverClass: 'active'
	};

	var newBubble = (function(lhs, rhs) {
		var dom = $("<button/>", {
			"class": "round bubble",
			"id": "bubble-x",
			"data-bubble": "x",
			"data-bubble-lhs": lhs,
			"data-bubble-rhs": rhs,
			"text": $("#bubble-" + lhs).text() + " ... " + $("#bubble-" + rhs).text()
		}).appendTo('.arena');
		dom.offset({
			left: $("#bubble-" + lhs).offset().left,
			top: $("#bubble-" + lhs).offset().top
		})
		dom.draggable(draggableOptions);
		dom.droppable(droppableOptions);
		dom.show();
		return dom;
	});

	$('body').on('click', '.operator', function() {
		if (!activeOperand) return;


	});

	$('body').on('dblclick', '.bubble', function() {
		var bubble = $(this).data("bubble");

		if (!bubble || bubble === 'x') {
			hideOperators();
		} else {
			game.divorce(bubble);
		}

		var lhs = $(this).data("bubble-lhs");
		var rhs = $(this).data("bubble-rhs");
		if (typeof lhs !== "undefined" && typeof rhs !== "undefined") {
			$("#bubble-" + lhs).show();
			$("#bubble-" + rhs).show();
			// TODO: place them accordingly
			$("#bubble-" + lhs).offset({
				left: $(this).offset().left - 60,
				top: $(this).offset().top
			});
			$("#bubble-" + rhs).offset({
				left: $(this).offset().left + 60,
				top: $(this).offset().top
			});

			// destroy this
			$(this).remove();
		}
	});

	// draggable + droppable
	$('.bubble').draggable(draggableOptions);
	$('.bubble').droppable(droppableOptions);

	// reposition bubbles!
	var bubbleOffset = [
		{left: 460, top: 130},
		{left: 625, top: 130},
		{left: 460, top: 295},
		{left: 625, top: 295}
	];
	for (var i = 0; i < 4; ++i) {
		$("#bubble-" + i).offset(bubbleOffset[i]);
	}

	// $('#generate').click(function() {
	// 	game.generate();
	// 	$('input').each(function(i, e) {
	// 		$(e).val(game.numbers[i]);
	// 	});
	// });
	// $('#check').click(function() {
	// 	$('input').each(function(i, e) {
	// 		game.numbers[i] = $(e).val();
	// 	});
	// 	var result = game.check();
	// 	alert(JSON.stringify(result));
	// });

});
	</script>
</body>
</html>