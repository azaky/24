$(function(){var t=new Game,e=["#add","#subtract","#multiply","#divide"],o=null,a=null,l=500===$(".container").width()?1:.65;$(window).resize(function(){l=500===$(".container").width()?1:.65});var i=function(t){var o=t.top>500,i=[{left:-120,top:50},{left:-40,top:70},{left:40,top:70},{left:120,top:50}];a=[];for(var n=0;4>n;++n){var b={left:i[n].left,top:i[n].top};o&&(b.top=i[n].top+$(e[n]).height()),b.left*=l,b.top*=l,a.push(b)}$.each(e,function(e,o){$(o).show().offset(t).css("opacity",0).animate({opacity:1,left:"+="+a[e].left,top:"+="+a[e].top},200)})},n=function(){$.each(e,function(t,e){$(e).hide()}),o=null,a=null},b={cancel:"input,textarea,select,option",containment:"#arena",start:function(){$(this).css("z-index",1e3)},stop:function(){$(this).css("z-index",0)},drag:function(){if(a&&"bubble-x"===$(this).attr("id")){var t={left:$(this).offset().left+$(this).width()/2,top:$(this).offset().top+$(this).height()/2};$.each(e,function(e,o){$(o).offset({left:t.left+a[e].left,top:t.top+a[e].top})})}}},f={activate:function(t,e){e.draggable.addClass("active")},deactivate:function(t,e){e.draggable.removeClass("active")},drop:function(t,e){var a=$(this).data("bubble"),l=e.draggable.data("bubble");if("x"!==a&&"x"!==l){null!==o&&$("#bubble-x").trigger("click");var n=r(l,a);i({left:n.offset().left+n.width()/2,top:n.offset().top+n.height()/2}),o={lhs:l,rhs:a},$(this).hide(),e.draggable.hide()}},hoverClass:"active"},r=function(t,e){var o=$("<button/>",{"class":"bubble",id:"bubble-x","data-bubble":"x","data-bubble-lhs":t,"data-bubble-rhs":e,text:$("#bubble-"+t).text()+" ... "+$("#bubble-"+e).text()}).appendTo(".game-arena");return o.offset({left:$("#bubble-"+t).offset().left,top:$("#bubble-"+t).offset().top}),o.draggable(b),o.droppable(f),o.show(),o},s=function(t){$(".game-arena, .game-menu").hide(),$("#"+t).show()};s("main-menu"),$("body").on("click",".operator",function(){if(o){var e=o.lhs,a=o.rhs,l=t.marry({lhs:e,rhs:a,op:$(this).data("op")});if(void 0===l)return void $("#bubble-x").trigger("click");var i=$("#bubble-x");i.data("bubble",l.i),i.text(l.rep),i.attr("id","bubble-"+l.i),n(),o=null}}),$("body").on("click",".bubble",function(){if(!$(this).hasClass("active")){var e=$(this).data("bubble");e&&"x"!==e?t.divorce(e):n();var o=$(this).data("bubble-lhs"),a=$(this).data("bubble-rhs");"undefined"!=typeof o&&"undefined"!=typeof a&&($("#bubble-"+o).show(),$("#bubble-"+a).show(),$("#bubble-"+o).offset({left:$(this).offset().left-60*l,top:$(this).offset().top}),$("#bubble-"+a).offset({left:$(this).offset().left+60*l,top:$(this).offset().top}),$(this).remove())}}),$(".bubble").draggable(b),$(".bubble").droppable(f);var u=function(){var e=[{left:120,top:50},{left:260,top:50},{left:120,top:190},{left:260,top:190}];1!==l&&(e=[{left:50,top:50},{left:150,top:50},{left:50,top:150},{left:150,top:150}]);for(var o=4;100>o;++o){var a=$("#bubble-"+o);a&&a.remove()}var a=$("#bubble-x");a&&a.remove(),n(),s("arena");var i;i=t.win()?t.nextLevel():t.restart();for(var b=$(".game-arena").offset(),o=0;4>o;++o){var f=$("#bubble-"+o);f.show(),f.offset({left:b.left+e[o].left,top:b.top+e[o].top}),f.text(i[o])}$("#score").text(t.getScore());var r=setInterval(function(){var e=t.getTimeLeft();if($("#timer").text(e),t.over())if($("#score").text(t.getScore()),$("#best-score").text(t.getHighScore()),clearInterval(r),t.win())s("level-menu");else{var o=t.getAnswer();$("#solution").text(o?"24 = "+o:"Unsolvable"),s("gameover-menu")}},100)};$("#no-solution").click(function(){t.guessUnsolved()}),$("#play, #next-level, #restart").on("click",function(){u()}),$("#home").on("click",function(){s("main-menu")}),$("#best-score").text(t.getHighScore()),$("#share").on("click",function(){FB.ui({method:"feed",link:"http://azaky.github.io/24",caption:"I got "+t.getScore()+" points on 24! http://azaky.github.io/24"},function(){})})});