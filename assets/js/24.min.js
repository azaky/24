var Game=function(e){var t,r=e&&e.goal||24,a=e&&e.n||4,s=e&&e.maxNumber||10,n=1e-7,u=!1,l=!1,h=!1,i=[],o=[],p=0,v=0,d={_data:{},setItem:function(e,t){return this._data[e]=String(t)},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){return delete this._data[e]},clear:function(){return this._data={}}};d=function(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),t}catch(r){return d}}();var f=this,c=function(){for(var e=[[]],t=function(e){for(var t=0,r=0;r<e.length;++r)("("===e[r]||")"===e[r])&&t++;return t},s=1;1<<a>s;++s){for(var u=[],l=0;a>l;++l)s&1<<l&&u.push(l);if(1===u.length)e[s]=[{value:o[u[0]],expr:o[u[0]],last:""}];else{for(var h={},i=[],p=1;1<<a>p;++p)if((p&s)===p&&p!==s){var v=s^p;if(!e[p]||!e[v])continue;for(var l=0;l<e[p].length;++l)for(var d=0;d<e[v].length;++d){dp1=e[p][l],dp1.value=Number(dp1.value),dp2=e[v][d],dp2.value=Number(dp2.value);var f=[{value:dp1.value+dp2.value,expr:dp1.expr+" + "+dp2.expr,last:"+-"},{value:dp1.value-dp2.value,expr:dp1.expr+" - "+("+-"===dp2.last?"(":"")+dp2.expr+("+-"===dp2.last?")":""),last:"+-"},{value:dp2.value-dp1.value,expr:dp2.expr+" - "+("+-"===dp1.last?"(":"")+dp1.expr+("+-"===dp1.last?")":""),last:"+-"},{value:dp1.value*dp2.value,expr:("+-"===dp1.last?"(":"")+dp1.expr+("+-"===dp1.last?")":"")+" x "+("+-"===dp2.last?"(":"")+dp2.expr+("+-"===dp2.last?")":""),last:"x/"}];dp1.value&&f.push({value:dp2.value/dp1.value,expr:("+-"===dp2.last?"(":"")+dp2.expr+("+-"===dp2.last?")":"")+" / "+(dp1.last?"(":"")+dp1.expr+(dp1.last?")":""),last:"x/"}),dp2.value&&f.push({value:dp1.value/dp2.value,expr:("+-"===dp1.last?"(":"")+dp1.expr+("+-"===dp1.last?")":"")+" / "+(dp2.last?"(":"")+dp2.expr+(dp2.last?")":""),last:"x/"});for(var c=0;c<f.length;++c){var g=t(f[c].expr);(!h[f[c].value]||h[f[c].value].brackets>g)&&(h[f[c].value]=f[c],h[f[c].value].brackets=g)}}}e[s]=[];for(key in h)h.hasOwnProperty(key)&&e[s].push(h[key])}}for(var x=[],m=(1<<a)-1,b=2*a,I=0,l=0;l<e[m].length;++l)if(Math.abs(e[m][l].value-r)<n){x.push(e[m][l]);var M=t(e[m][l].expr);b>M&&(I=x.length-1,b=M)}if(x.length){var i=x[0];x[0]=x[I],x[I]=i}return x},g=function(){o=[];for(var e=0;a>e;++e)o[e]=Math.floor(Math.random()*s)+1;u=c(),u=u.length?u[0].expr:!1},x=function(e){e?l=!0:h=!0,clearInterval(t);var r=d.getItem("highScore"),a=f.getScore();(null===r||a>r)&&(r=a),d.setItem("highScore",r)};return this.marry=function(e){if(!this.over()&&void 0!==e.lhs&&void 0!==e.rhs&&e.lhs!==e.rhs&&i[e.lhs]&&i[e.rhs]&&!i[e.lhs].used&&!i[e.rhs].used){var t,s,u=i.length,l=i[e.lhs].value,h=i[e.rhs].value;switch(e.op){case"+":t=l+h;break;case"-":t=l-h;break;case"*":case"x":case"X":t=l*h;break;case"/":if(Math.abs(h)<n)return;t=l/h;break;default:return void alert("op = ["+e.op+"]")}if(s=""+Math.round(t),Math.abs(Math.round(t)-t)>n)for(var o=1;;++o){var p=o*t;if(Math.abs(Math.round(p)-p)<n){s=""+Math.round(p)+"/"+o;break}}i.push({i:u,value:t,rep:s,lhs:e.lhs,rhs:e.rhs,used:!1}),i[e.lhs].used=!0,i[e.rhs].used=!0;var v=0,d=function(e){a>e?v|=1<<e:(d(i[e].lhs),d(i[e].rhs))};return d(u),v===(1<<a)-1&&Math.abs(t-r)<n&&x(!0),i[u]}},this.divorce=function(e){if(!this.over()&&i[e]&&i[e].hasOwnProperty("lhs")&&i[e].hasOwnProperty("rhs")){var t=i[i[e].lhs],r=i[i[e].rhs];return t.used=r.used=!1,i[e]=void 0,{lhs:t,rhs:r}}},this.restart=function(){return this.over()||clearInterval(t),l=!0,h=!1,p=0,this.nextLevel()},this.nextLevel=function(){if(this.over()&&!this.lose()){g(),p++,i=[];for(var e=0;a>e;++e)i[e]={i:e,value:o[e],rep:o[e],used:!1};return l=!1,h=!1,v=this.getTimeLimit(),t=setInterval(function(){v--,0>=v&&(v=0,x(!1))},1e3),o}},this.guessUnsolved=function(){return u?(x(!1),!1):(x(!0),!0)},this.win=function(){return l},this.lose=function(){return h},this.over=function(){return this.win()||this.lose()},this.getTimeLimit=function(){return Math.floor(100/(p+1))+10},this.getTimeLeft=function(){return v},this.getLevel=function(){return p},this.getScore=function(){return p+(this.win()?0:-1)},this.getHighScore=function(){var e=d.getItem("highScore");return null===e&&(e=0,d.setItem("highScore",e)),e},this.getAnswer=function(){return this.over()?u:"Nice try, don't cheat :)"},this.getNumbers=function(){return o},this.getBubbles=function(){return i},this};