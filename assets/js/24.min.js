(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){var Game=function(args){var goal=args&&args.goal||24;var n=args&&args.n||4;var maxNumber=args&&args.maxNumber||10;var epsilon=1e-7;var answer=false,solved=false,fail=false;var bubbles=[];var numbers=[];var level=0;var timeLeft=0,timeStopper;var storage={_data:{},setItem:function(id,val){return this._data[id]=String(val)},getItem:function(id){return this._data.hasOwnProperty(id)?this._data[id]:undefined},removeItem:function(id){return delete this._data[id]},clear:function(){return this._data={}}};storage=function(){var testKey="test";var _storage=window.localStorage;try{_storage.setItem(testKey,"1");_storage.removeItem(testKey);return _storage}catch(error){return storage}}();var that=this;var checkAnswer=function(){var dp=[[]];var countBrackets=function(expr){var ret=0;for(var i=0;i<expr.length;++i){if(expr[i]==="("||expr[i]===")")ret++}return ret};for(var mask=1;mask<1<<n;++mask){var bits=[];for(var i=0;i<n;++i){if(mask&1<<i){bits.push(i)}}if(bits.length===1){dp[mask]=[{value:numbers[bits[0]],expr:numbers[bits[0]],last:""}]}else{var used={};var temp=[];for(var mask1=1;mask1<1<<n;++mask1){if((mask1&mask)===mask1&&mask1!==mask){var mask2=mask^mask1;if(!dp[mask1]||!dp[mask2])continue;for(var i=0;i<dp[mask1].length;++i){for(var j=0;j<dp[mask2].length;++j){dp1=dp[mask1][i];dp1.value=Number(dp1.value);dp2=dp[mask2][j];dp2.value=Number(dp2.value);var possibilities=[{value:dp1.value+dp2.value,expr:dp1.expr+" + "+dp2.expr+"",last:"+-"},{value:dp1.value-dp2.value,expr:dp1.expr+" - "+(dp2.last==="+-"?"(":"")+dp2.expr+(dp2.last==="+-"?")":""),last:"+-"},{value:dp2.value-dp1.value,expr:dp2.expr+" - "+(dp1.last==="+-"?"(":"")+dp1.expr+(dp1.last==="+-"?")":""),last:"+-"},{value:dp1.value*dp2.value,expr:(dp1.last==="+-"?"(":"")+dp1.expr+(dp1.last==="+-"?")":"")+" x "+(dp2.last==="+-"?"(":"")+dp2.expr+(dp2.last==="+-"?")":""),last:"x/"}];if(dp1.value){possibilities.push({value:dp2.value/dp1.value,expr:(dp2.last==="+-"?"(":"")+dp2.expr+(dp2.last==="+-"?")":"")+" / "+(dp1.last?"(":"")+dp1.expr+(dp1.last?")":""),last:"x/"})}if(dp2.value){possibilities.push({value:dp1.value/dp2.value,expr:(dp1.last==="+-"?"(":"")+dp1.expr+(dp1.last==="+-"?")":"")+" / "+(dp2.last?"(":"")+dp2.expr+(dp2.last?")":""),last:"x/"})}for(var k=0;k<possibilities.length;++k){var brackets=countBrackets(possibilities[k].expr);if(!used[possibilities[k].value]||used[possibilities[k].value].brackets>brackets){used[possibilities[k].value]=possibilities[k];used[possibilities[k].value].brackets=brackets}}}}}}dp[mask]=[];for(key in used){if(used.hasOwnProperty(key)){dp[mask].push(used[key])}}}}var _answer=[];var goalmask=(1<<n)-1;var minBrackets=n*2;var iminBrackets=0;for(var i=0;i<dp[goalmask].length;++i){if(Math.abs(dp[goalmask][i].value-goal)<epsilon){_answer.push(dp[goalmask][i]);var curBrackets=countBrackets(dp[goalmask][i].expr);if(curBrackets<minBrackets){iminBrackets=_answer.length-1;minBrackets=curBrackets}}}if(_answer.length){var temp=_answer[0];_answer[0]=_answer[iminBrackets];_answer[iminBrackets]=temp}return _answer};var generate=function(){numbers=[];for(var i=0;i<n;++i){numbers[i]=Math.floor(Math.random()*maxNumber)+1}answer=checkAnswer();if(!answer.length){answer=false}else{answer=answer[0].expr}};var finishGame=function(result){if(result){solved=true}else{fail=true}clearInterval(timeStopper);var highScore=storage.getItem("highScore");var curScore=that.getScore();if(highScore===null||curScore>highScore){highScore=curScore}storage.setItem("highScore",highScore)};this.marry=function(args){if(this.over())return;if(args.lhs===undefined||args.rhs===undefined||args.lhs===args.rhs||!bubbles[args.lhs]||!bubbles[args.rhs]||bubbles[args.lhs].used||bubbles[args.rhs].used){return}var last=bubbles.length;var value,rep;var n1=bubbles[args.lhs].value;var n2=bubbles[args.rhs].value;switch(args.op){case"+":value=n1+n2;break;case"-":value=n1-n2;break;case"*":case"x":case"X":value=n1*n2;break;case"/":if(Math.abs(n2)<epsilon){return}value=n1/n2;break;default:alert("op = ["+args.op+"]");return}rep=""+Math.round(value);if(Math.abs(Math.round(value)-value)>epsilon){for(var den=1;;++den){var num=den*value;if(Math.abs(Math.round(num)-num)<epsilon){rep=""+Math.round(num)+"/"+den;break}}}bubbles.push({i:last,value:value,rep:rep,lhs:args.lhs,rhs:args.rhs,used:false});bubbles[args.lhs].used=true;bubbles[args.rhs].used=true;var mask=0;var dfs=function(i){if(i<n){mask|=1<<i}else{dfs(bubbles[i].lhs);dfs(bubbles[i].rhs)}};dfs(last);if(mask===(1<<n)-1&&Math.abs(value-goal)<epsilon){finishGame(true)}return bubbles[last]};this.divorce=function(i){if(this.over())return;if(bubbles[i]&&bubbles[i].hasOwnProperty("lhs")&&bubbles[i].hasOwnProperty("rhs")){var lhs=bubbles[bubbles[i].lhs];var rhs=bubbles[bubbles[i].rhs];lhs.used=rhs.used=false;bubbles[i]=undefined;return{lhs:lhs,rhs:rhs}}};this.restart=function(){if(!this.over()){clearInterval(timeStopper)}timeLeft=0;solved=true;fail=false;level=0;return this.nextLevel()};this.nextLevel=function(){if(!this.over()||this.lose()){return}generate();level++;bubbles=[];for(var i=0;i<n;++i){bubbles[i]={i:i,value:numbers[i],rep:numbers[i],used:false}}solved=false;fail=false;timeLeft+=this.getTimeAddition();timeStopper=setInterval(function(){timeLeft--;if(timeLeft<=0){timeLeft=0;finishGame(false)}},1e3);return numbers};this.guessUnsolved=function(){if(this.over()){return}if(!answer){finishGame(true);return true}else{finishGame(false);return false}};this.win=function(){return solved};this.lose=function(){return fail};this.over=function(){return this.win()||this.lose()};this.getTimeAddition=function(){if(level===1){return 60-timeLeft}return Math.ceil(30/level)};this.getTimeLeft=function(){return timeLeft};this.getLevel=function(){return level};this.getScore=function(){return level+(this.win()?0:-1)};this.getHighScore=function(){var highScore=storage.getItem("highScore");if(highScore===null){highScore=0;storage.setItem("highScore",highScore)}return highScore};this.getAnswer=function(){if(!this.over()){return"Nice try, don't cheat :)"}else{return answer}};this.getNumbers=function(){return numbers};this.getBubbles=function(){return bubbles};return this}},{}]},{},[1]);
